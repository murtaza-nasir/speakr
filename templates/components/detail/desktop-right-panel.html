<!-- Desktop Right Panel (Summary/Notes/Chat) -->
<div id="rightMainColumn" class="flex flex-col overflow-hidden" :style="{width: rightColumnWidth + '%'}">
    <!-- Custom Audio Player -->
    <div class="bg-[var(--bg-secondary)] px-5 py-4 border-b border-[var(--border-primary)] flex-shrink-0">
        <!-- Show message if audio has been deleted -->
        <div v-if="selectedRecording.audio_deleted_at"
             class="text-[var(--text-muted)] text-sm flex items-center gap-2">
            <i class="fas fa-info-circle"></i>
            <span v-text="t('help.audioDeletedMessage')"></span>
        </div>
        <!-- Custom Audio Player -->
        <div v-else class="flex items-center gap-4">
            <!-- Hidden audio element -->
            <audio ref="audioPlayerElement"
                   :src="'/audio/' + selectedRecording.id"
                   :volume="playerVolume"
                   @play="handleAudioPlayPause"
                   @pause="handleAudioPlayPause"
                   @timeupdate="handleCustomAudioTimeUpdate"
                   @loadedmetadata="handleAudioLoadedMetadata"
                   @ended="handleAudioEnded"
                   @waiting="handleAudioWaiting"
                   @canplay="handleAudioCanPlay"
                   class="hidden">
            </audio>

            <!-- Play/Pause Button -->
            <button @click="toggleAudioPlayback"
                    class="w-10 h-10 flex items-center justify-center rounded-full bg-[var(--bg-accent)] hover:bg-[var(--bg-accent-hover)] text-white transition-all duration-200 flex-shrink-0 shadow-sm"
                    :title="audioIsPlaying ? 'Pause' : 'Play'">
                <i :class="audioIsPlaying ? 'fas fa-pause' : 'fas fa-play'" class="text-base" :style="!audioIsPlaying ? 'margin-left: 2px' : ''"></i>
            </button>

            <!-- Time Display -->
            <div class="flex flex-col items-end flex-shrink-0 leading-tight">
                <span class="text-sm text-[var(--text-primary)] font-mono">${ formatAudioTime(audioCurrentTime) }</span>
                <span class="text-xs text-[var(--text-muted)] font-mono">${ formatAudioTime(audioDuration) }</span>
            </div>

            <!-- Progress Bar -->
            <div class="flex-1 h-2 bg-[var(--bg-tertiary)] rounded-full cursor-pointer group relative"
                 @click="(e) => { const rect = e.currentTarget.getBoundingClientRect(); seekAudioByPercent(((e.clientX - rect.left) / rect.width) * 100); }">
                <div class="h-full bg-[var(--bg-accent)] rounded-full transition-all duration-100 relative"
                     :style="{ width: audioProgressPercent + '%' }">
                    <div class="absolute right-0 top-1/2 -translate-y-1/2 w-3.5 h-3.5 bg-[var(--bg-accent)] rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-sm"></div>
                </div>
            </div>

            <!-- Volume Control -->
            <div class="flex items-center gap-2 flex-shrink-0">
                <button @click="toggleAudioMute"
                        class="w-9 h-9 flex items-center justify-center rounded-lg hover:bg-[var(--bg-tertiary)] text-[var(--text-muted)] hover:text-[var(--text-primary)] transition-all"
                        :title="audioIsMuted ? 'Unmute' : 'Mute'">
                    <i :class="audioIsMuted || playerVolume === 0 ? 'fas fa-volume-mute' : playerVolume < 0.5 ? 'fas fa-volume-down' : 'fas fa-volume-up'" class="text-base"></i>
                </button>
                <input type="range" min="0" max="1" step="0.05"
                       :value="playerVolume"
                       @input="(e) => setAudioVolume(parseFloat(e.target.value))"
                       class="volume-slider w-20 h-1.5 cursor-pointer">
            </div>

            <!-- Download Button -->
            <a :href="'/audio/' + selectedRecording.id + '?download=true'"
               download
               class="w-9 h-9 flex items-center justify-center rounded-lg hover:bg-[var(--bg-tertiary)] text-[var(--text-muted)] hover:text-[var(--text-primary)] transition-all"
               :title="t('buttons.downloadAudio') || 'Download audio'">
                <i class="fas fa-download text-base"></i>
            </a>
        </div>
    </div>

    <!-- Summary/Notes Tabs -->
    <div :class="{'flex-1': !isChatMaximized, 'flex-none': isChatMaximized}" class="flex flex-col overflow-hidden">
        <!-- Tab Navigation -->
        <div class="bg-[var(--bg-tertiary)] border-b border-[var(--border-primary)] flex">
            <button @click="selectedTab = 'summary'"
                    :class="[
                        'flex-1 px-4 py-3 text-sm font-medium transition-colors',
                        selectedTab === 'summary'
                            ? 'bg-[var(--bg-secondary)] text-[var(--text-accent)] border-b-2 border-[var(--border-focus)]'
                            : 'text-[var(--text-muted)] hover:text-[var(--text-secondary)]'
                    ]">
                ${ t('summary.title') }
            </button>
            <button @click="selectedTab = 'notes'"
                    :class="[
                        'flex-1 px-4 py-3 text-sm font-medium transition-colors',
                        selectedTab === 'notes'
                            ? 'bg-[var(--bg-secondary)] text-[var(--text-accent)] border-b-2 border-[var(--border-focus)]'
                            : 'text-[var(--text-muted)] hover:text-[var(--text-secondary)]'
                    ]">
                ${ t('notes.title') }
            </button>
            <button v-if="selectedRecording.events && selectedRecording.events.length > 0"
                    @click="selectedTab = 'events'"
                    :class="[
                        'flex-1 px-4 py-3 text-sm font-medium transition-colors',
                        selectedTab === 'events'
                            ? 'bg-[var(--bg-secondary)] text-[var(--text-accent)] border-b-2 border-[var(--border-focus)]'
                            : 'text-[var(--text-muted)] hover:text-[var(--text-secondary)]'
                    ]">
                <i class="fas fa-calendar-alt mr-1"></i>
                ${ t('events.title') } (${ selectedRecording.events.length })
            </button>
        </div>

        <!-- Tab Content -->
        <div v-if="!isChatMaximized" class="flex-1 overflow-hidden">
            {% include 'components/detail/desktop-summary-tab.html' %}
            {% include 'components/detail/desktop-notes-tab.html' %}
            {% include 'components/detail/desktop-events-tab.html' %}
        </div>
    </div>

    <!-- Chat Section -->
    {% include 'components/detail/desktop-chat-section.html' %}
</div>
